{% extends 'AdminLayout.html.twig' %}

{% block card_title %} Gestionaire : Tag <a class="text-right" href="#" data-toggle="modal" data-target="#form_modal"> <i class="now-ui-icons ui-1_simple-add"></i></a>{% endblock %}

{% block body %}

    <div class="table-responsive">
        <table class="table">
            <thead class=" text-primary">
            <tr>
                <th>
                    id
                </th>
                <th>
                    Nom
                </th>
                <th>
                    Etat
                </th>
                <th class="text-right">
                    Action
                </th>
            </tr></thead>
            <tbody id="liste">
            {% for data in datas %}
            <tr>
                <td>{{ data.id }}</td>
                <td>{{ data.name }}</td>
                <td>
                    {% if data.etat %} <i class="now-ui-icons ui-1_check"></i> {% endif %}
                </td>
                <td class="text-right">
                    <a onclick="UpdateTag(this, event);" href="{{ path('Tag_Update', {id:data.id}) }}"> <i class="now-ui-icons ui-1_settings-gear-63"></i></a>
                    <a onclick="DepletedTag(this, event, '{{ data.name }}');" href="{{ path('Tag_delete',{id:data.id}) }}"> <i class="now-ui-icons ui-1_simple-remove"></i></a>
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

{% endblock %}

{% block JS %}
    {{ parent() }}
    <script>

        function UpdateTag($this, e) {
            var $link = $($this).attr("href");
            console.log('update click');
            console.info($link);
            e.preventDefault();
           $.ajax({
                method: 'GET',
                url: $link
           }).done(function ($data){
                console.log("done");
                $("#modal-container").html($data);
                $("#form_modal").modal();


                // ========== form post =====

               $("form").submit(function(event){
                   event.preventDefault();
                   console.log(event);
                   stop();
                   var datas= $( this ).serialize();
                   var target = $(this).attr("action");
                   $.ajax({
                       method : 'POST',
                       url: target,
                       data: datas
                   }).done(function ($data, $txt, $xhr) {
                       if($xhr.status == 204){
                           location.reload();
                       }else{
                           $("#modal-container").html($data);
                       }
                   });
               });


            });
        }

        function DepletedTag($this, e, $name) {
            e.preventDefault();
            var $link = $($this).attr('href');
            $('#text_modal').html("Voulez vous vraiment supprimer le tag : " + $name);
            $('#current_modal').modal('toggle');
            $('#valid_supr').click(function () {
                console.log($link);
                $('#liste').html('<td colspan="4"><img src="{{ asset('img/load.gif') }}" class="rounded mx-auto d-block" style="height: 50px;"></td>');
                $.ajax({
                    method: 'POST',
                    url:$link
                }).done(function (data) {
                    $('#liste').html(data);
                    $('#valid_supr').off("click");
                });
            });
        }

    </script>
{% endblock %}

{% block modal_body %}
    {{ form_start(form) }}
    <div class="modal-header">
        <h4 class="modal-title">Nouveau Tag</h4>
    </div>
    <div class="modal-body">
        {{ form_widget(form) }}
    </div>
    <div class="modal-footer">
        <button id="submit" name="submit" class="btn btn-success">Valider</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
    </div>
    {{ form_end(form) }}
{% endblock %}
